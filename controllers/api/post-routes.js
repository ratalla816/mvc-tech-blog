const router=require("express").Router(),{Post:Post,User:User,Comment:Comment}=require("../../models"),withAuth=require("../../utils/auth");router.get("/",withAuth,(t,e)=>{console.log(t.session),Post.findAll({attributes:["id","title","created_at","post_content"],order:["created_at"],include:[{model:Comment,attributes:["id","comment_text","post_id","user_id","created_at"],include:{model:User,attributes:["username"]}},{model:User,attributes:["username"]}]}).then(t=>e.json(t)).catch(t=>{console.log(t),e.status(500).json(t)})}),router.get("/:id",(t,e)=>{Post.findOne({where:{id:t.params.id},attributes:["id","title","created_at","post_content"],include:[{model:User,attributes:["username"]},{model:Comment,attributes:["id","comment_text","post_id","user_id","created_at"],include:{model:User,attributes:["username"]}}]}).then(t=>{t?e.json(t):e.status(404).json({message:"No posts found"})}).catch(t=>{console.log(t),e.status(500).json(t)})}),router.post("/",withAuth,(t,e)=>{Post.create({title:t.body.title,post_content:t.body.post_content,user_id:t.session.user_id}).then(t=>e.json(t)).catch(t=>{console.log(t),e.status(500).json(t)})}),router.put("/:id",withAuth,(t,e)=>{Post.update({title:t.body.title,post_content:t.body.post_content},{where:{id:t.params.id}}).then(t=>{t?e.json(t):e.status(404).json({message:"No posts found"})}).catch(t=>{console.log(t),e.status(500).json(t)})}),router.delete("/:id",withAuth,(t,e)=>{console.log("id",t.params.id),Post.destroy({where:{id:t.params.id}}).then(t=>{t?e.json(t):e.status(404).json({message:"No posts found"})}).catch(t=>{console.log(t),e.status(500).json(t)})}),module.exports=router;