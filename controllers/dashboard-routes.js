const router=require("express").Router(),{Post:Post,User:User,Comment:Comment}=require("../models"),withAuth=require("../utils/auth");router.get("/",withAuth,(e,t)=>{console.log(e.session),Post.findAll({where:{user_id:e.session.user_id},attributes:["id","title","created_at","post_content"],include:[{model:Comment,attributes:["id","comment_text","post_id","user_id","created_at"],include:{model:User,attributes:["username"]}},{model:User,attributes:["username"]}]}).then(e=>{const s=e.map(e=>e.get({plain:!0}));t.render("dashboard",{posts:s,loggedIn:!0})}).catch(e=>{console.log(e),t.status(500).json(e)})}),router.get("/new/",withAuth,(e,t)=>{Post.findAll({where:{user_id:e.session.user_id},attributes:["id","title","created_at","post_content"],include:[{model:Comment,attributes:["id","comment_text","post_id","user_id","created_at"],include:{model:User,attributes:["username"]}},{model:User,attributes:["username"]}]}).then(e=>{const s=e.map(e=>e.get({plain:!0}));t.render("new-post",{posts:s,loggedIn:!0})}).catch(e=>{console.log(e),t.status(500).json(e)})}),router.get("/edit/:id",withAuth,(e,t)=>{Post.findOne({where:{id:e.params.id},attributes:["id","title","created_at","post_content"],include:[{model:Comment,attributes:["id","comment_text","post_id","user_id","created_at"],include:{model:User,attributes:["username"]}},{model:User,attributes:["username"]}]}).then(e=>{if(e){const s=e.get({plain:!0});t.render("edit-post",{post:s,loggedIn:!0})}else t.status(404).end()}).catch(e=>{console.log(e),t.status(500).json(e)})}),module.exports=router;