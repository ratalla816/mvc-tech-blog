const router=require("express").Router(),{Post:Post,User:User,Comment:Comment}=require("../models");router.get("/",(e,t)=>{Post.findAll({attributes:["id","title","created_at","post_content"],include:[{model:Comment,attributes:["id","comment_text","post_id","user_id","created_at"],include:{model:User,attributes:["username"]}},{model:User,attributes:["username"]}]}).then(s=>{const o=s.map(e=>e.get({plain:!0}));t.render("homepage",{posts:o,loggedIn:e.session.loggedIn})}).catch(e=>{console.log(e),t.status(500).json(e)})}),router.get("/post/:id",(e,t)=>{Post.findOne({where:{id:e.params.id},attributes:["id","title","created_at","post_content"],include:[{model:Comment,attributes:["id","comment_text","post_id","user_id","created_at"],include:{model:User,attributes:["username"]}},{model:User,attributes:["username"]}]}).then(s=>{if(!s)return void t.status(404).json({message:"post not found"});const o=s.get({plain:!0});t.render("single-post",{post:o,loggedIn:e.session.loggedIn})}).catch(e=>{console.log(e),t.status(500).json(e)})}),router.get("/login",(e,t)=>{e.session.loggedIn?t.redirect("/"):t.render("login")}),router.get("/signup",(e,t)=>{e.session.loggedIn?t.redirect("/"):t.render("signup")}),module.exports=router;